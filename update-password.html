<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reset Password • EaseKolar Style</title>
  <meta name="color-scheme" content="light only" />
  <style>
    :root{
      --bg:#f5f7fa;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#0f172a;
      --primary:#2563eb;
      --primary-hover:#1d4ed8;
      --ring:#dbe3ff;
      --success:#16a34a;
      --success-weak:#ecfdf5;
      --success-border:#bbf7d0;
      --neutral:#64748b;
      --neutral-weak:#f1f5f9;
      --neutral-border:#e2e8f0;
      --shadow:0 10px 30px rgba(15,23,42,.08);
      --radius:18px;
      --chip:#eef2ff;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .shell{ width:min(980px, 100%); }

    /* HERO CARD */
    .hero{
      position:relative;
      border-radius: 22px;
      overflow:hidden;
      background: radial-gradient(1200px 500px at -10% -40%, #223a78 0%, #0f1e4a 45%, #0b1536 100%);
      color:#e7ecff;
      padding:42px clamp(24px, 5vw, 56px);
      box-shadow: var(--shadow);
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.15) 50%, transparent 55%) repeat,
        radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,.12) 50%, transparent 55%) repeat;
      background-size: 180px 140px, 220px 180px;
      pointer-events:none;
      mix-blend-mode:screen;
    }
    .hero-inner{ display:grid; grid-template-columns: 1.2fr .8fr; gap:24px; align-items:center; }
    @media (max-width:820px){ .hero-inner{grid-template-columns:1fr; gap:18px} }
    .hero h1{ font-size: clamp(28px, 3.2vw, 40px); margin:0 0 10px 0; letter-spacing:.2px; }
    .hero p{ margin:0 0 18px 0; color:#cdd6ff; max-width:48ch; line-height:1.5; }
    .hero-actions{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      border:0; cursor:pointer; font-weight:600;
      padding:12px 18px; border-radius:999px;
      transition: transform .08s ease, background .2s ease, box-shadow .2s ease;
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
    }
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--primary); color:#fff}
    .btn-primary:hover{background:var(--primary-hover)}
    .btn-ghost{
      background: rgba(255,255,255,.12); color:#e7ecff; backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,.18);
      box-shadow:none;
    }
    .emblem{
      justify-self:end; align-self:center;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 20px;
      padding:22px;
      width:min(260px, 70%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
    }
    .emblem svg{display:block; width:100%; height:auto}

    /* CONTENT CARD */
    .card{
      margin-top:18px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(18px, 3.2vw, 28px);
    }

    .grid{ display:grid; grid-template-columns: 1fr 320px; gap: 20px; }
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    .section-title{font-size:18px;margin:0 0 8px}
    .muted{color:var(--muted); font-size:14px; margin:0 0 18px}
    label{display:block; font-weight:600; margin:12px 0 8px}
    .input{ position:relative; }
    input[type="password"], input[type="text"]{
      width:100%; border:1px solid #e5e7eb; border-radius:12px;
      padding:14px 44px 14px 14px; font-size:15px; outline:none;
      transition:border .2s ease, box-shadow .2s ease;
      background:#f9fafb;
    }
    input:focus{ border-color: var(--primary); box-shadow: 0 0 0 4px var(--ring); background:#fff; }
    .toggle{
      position:absolute; right:8px; top:50%; transform:translateY(-50%);
      border:0; background:transparent; cursor:pointer; padding:8px; border-radius:8px;
      color:#475569;
    }

    /* Overall hint */
    .hint{
      margin-top:8px; font-size:13px; color:var(--muted);
      display:flex; align-items:center; gap:8px;
    }
    .hint .dot{ width:8px;height:8px;border-radius:999px;background:#cbd5e1; }
    .hint.ok .dot{ background: var(--success); }
    .hint.bad .dot{ background: #eab308; } /* keep neutral-ish for weak */

    .actions{display:flex; gap:12px; margin-top:16px; align-items:center}
    .btn-wide{min-width:180px}

    /* Requirement chips */
    .side{ display:grid; gap:12px; align-content:start; }
    .panel{ border:1px solid #eef2f7; background:#fbfcff; border-radius:16px; padding:14px; }
    .panel h4{margin:0 0 10px 0; font-size:14px; color:#111827}

    .chip{
      display:inline-flex; align-items:center; gap:10px;
      padding:8px 12px; border-radius:999px; margin:6px 6px 0 0;
      background: var(--neutral-weak);
      border:1px solid var(--neutral-border);
      font-size:13px; color:#334155; font-weight:600;
      transition: background .2s ease, border-color .2s ease, color .2s ease;
    }
    .chip .status{
      width:18px; height:18px; border-radius:999px;
      display:inline-flex; align-items:center; justify-content:center;
      background: var(--neutral-border);
      color: var(--neutral); flex:0 0 auto;
      transition: background .2s ease, color .2s ease;
    }
    .chip .status svg{ width:12px; height:12px; stroke:currentColor; stroke-width:3; fill:none; }

    /* Satisfied = green check */
    .req.ok{
      background: var(--success-weak);
      border-color: var(--success-border);
      color:#065f46;
    }
    .req.ok .status{
      background: var(--success);
      color:#fff;
    }
    /* Unsatisfied = neutral gray, no red */
    .req.bad{
      background: var(--neutral-weak);
      border-color: var(--neutral-border);
      color:#334155;
    }

    .note{ font-size:12.5px; color:var(--muted); line-height:1.45; margin-top:8px; }

    .toast{
      position: fixed; bottom:18px; left:50%; transform:translateX(-50%);
      background:#0b1536; color:#e7ecff; padding:12px 16px; border-radius:12px;
      box-shadow: var(--shadow); display:none;
    }
    .toast.show{display:block; animation:fade 2.6s both}
    @keyframes fade{
      0%{opacity:0; transform:translate(-50%, 8px)}
      10%,80%{opacity:1; transform:translate(-50%, 0)}
      100%{opacity:0; transform:translate(-50%, 8px)}
    }

    a.link{color:#334155; text-decoration:none; font-weight:600}
    a.link:hover{ text-decoration:underline }
  </style>
</head>
<body>
  <main class="shell">
    <!-- HERO -->
    <section class="hero">
      <div class="hero-inner">
        <div>
          <h1>Reset your password</h1>
          <p>Apply the new credentials to continue securely. Strong passwords help keep your
             account—and scholarship data—safe.</p>
          <div class="hero-actions">
            <a class="btn btn-ghost" href="login.html" aria-label="Back to Login">Back to login</a>
          </div>
        </div>
        <div class="emblem" aria-hidden="true">
          <svg viewBox="0 0 192 192" fill="none" role="img">
            <defs>
              <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="#94a3b8"/>
                <stop offset="1" stop-color="#475569"/>
              </linearGradient>
            </defs>
            <path d="M12 70 96 30l84 40-84 40L12 70Z" fill="url(#g1)"/>
            <path d="M36 86v26c0 16 27 30 60 30s60-14 60-30V86" stroke="#9aa7bd" stroke-width="10" stroke-linecap="round"/>
            <path d="M62 116l20 20 48-48" stroke="#f2b705" stroke-width="14" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
    </section>

    <!-- CONTENT -->
    <section class="card">
      <div class="grid">
        <!-- Form -->
        <div>
          <h3 class="section-title">Create a new password</h3>
          <p class="muted">Use at least 8 characters. For best results, include a mix of letters, numbers, and symbols.</p>

          <label for="newPassword">New password</label>
          <div class="input">
            <input id="newPassword" name="newPassword" type="password" autocomplete="new-password" placeholder="••••••••" required/>
            <button class="toggle" type="button" id="toggleVisibility" aria-label="Show or hide password">
              <svg id="eye" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>

          <div id="strengthHint" class="hint"><span class="dot"></span><span>Enter a password…</span></div>

          <div class="actions">
            <button class="btn btn-primary btn-wide" id="submitBtn" onclick="updatePassword()">Update password</button>
            <a class="link" href="login.html" aria-label="Back to login">Cancel</a>
          </div>
        </div>

        <!-- Side tips -->
        <aside class="side" aria-label="Password tips">
          <div class="panel">
            <h4>Requirements</h4>

            <span id="reqLen"  class="chip req bad" title="8+ characters">
              <span class="status" aria-hidden="true">
                <!-- neutral dash by default -->
                <svg viewBox="0 0 24 24"><path d="M5 12h14"/></svg>
              </span>
              8+ characters
            </span>

            <span id="reqCase" class="chip req bad" title="Upper &amp; lower case">
              <span class="status" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M5 12h14"/></svg>
              </span>
              Upper &amp; lower case
            </span>

            <span id="reqNum" class="chip req bad" title="Number">
              <span class="status" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M5 12h14"/></svg>
              </span>
              Number
            </span>

            <span id="reqSym" class="chip req bad" title="Symbol">
              <span class="status" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M5 12h14"/></svg>
              </span>
              Symbol
            </span>

            <p class="note">We’ll sign you out on other sessions as soon as this is updated.</p>
          </div>

          <div class="panel">
            <h4>Security</h4>
            <p class="note">Avoid reusing passwords. Consider a password manager for unique, strong phrases.</p>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://evhccomzwzcwtlzjkcig.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV2aGNjb216d3pjd3RsemprY2lnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NDg2NjcsImV4cCI6MjA3MjIyNDY2N30.GL3cvUlJs7woFRXBgc0x3JAH93ZysfbN7jmbamcnb8c";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const input = document.getElementById("newPassword");
    const toggle = document.getElementById("toggleVisibility");
    const eye = document.getElementById("eye");
    const hint = document.getElementById("strengthHint");
    const submitBtn = document.getElementById("submitBtn");
    const toast = document.getElementById("toast");

    // Requirement chips
    const reqLen  = document.getElementById("reqLen");
    const reqCase = document.getElementById("reqCase");
    const reqNum  = document.getElementById("reqNum");
    const reqSym  = document.getElementById("reqSym");

    function setHint(state, text){
      hint.classList.remove("ok","bad");
      if(state === "ok") hint.classList.add("ok");
      if(state === "bad") hint.classList.add("bad");
      hint.lastElementChild.textContent = text;
    }

    // toggle chip state & icon
    function setReq(el, satisfied){
      el.classList.toggle("ok",  satisfied);
      el.classList.toggle("bad", !satisfied);
      const icon = el.querySelector(".status");
      icon.innerHTML = satisfied
        ? '<svg viewBox="0 0 24 24"><path d="M4 12l5 5 11-11"/></svg>' // green check
        : '<svg viewBox="0 0 24 24"><path d="M5 12h14"/></svg>';        // neutral dash
    }

    function scorePassword(pw){
      let score = 0;
      if(!pw) return 0;
      const sets = [/[a-z]/, /[A-Z]/, /[0-9]/, /[^A-Za-z0-9]/];
      sets.forEach(rx => { if(rx.test(pw)) score += 1; });
      if(pw.length >= 8) score += 1;
      if(pw.length >= 12) score += 1;
      return Math.min(score, 6);
    }

    function updateRequirements(pw){
      const hasLower = /[a-z]/.test(pw);
      const hasUpper = /[A-Z]/.test(pw);
      const hasNum   = /[0-9]/.test(pw);
      const hasSym   = /[^A-Za-z0-9]/.test(pw);

      setReq(reqLen,  pw.length >= 8);
      setReq(reqCase, hasLower && hasUpper);
      setReq(reqNum,  hasNum);
      setReq(reqSym,  hasSym);
    }

    input.addEventListener("input", () => {
      const val = input.value;
      const s = scorePassword(val);
      updateRequirements(val);

      if(!val){
        setHint("", "Enter a password…");
        return;
      }
      if(s <= 2) setHint("bad", "Weak — add length & variety");
      else if(s <= 4) setHint("", "Okay — you can make it stronger");
      else setHint("ok", "Great — strong password");
    });

    toggle.addEventListener("click", () => {
      const isPw = input.type === "password";
      input.type = isPw ? "text" : "password";
      eye.innerHTML = isPw
        ? '<line x1="1" y1="1" x2="23" y2="23"></line><path d="M10.58 10.58a3 3 0 1 0 4.24 4.24"></path><path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.77 21.77 0 0 1 5.06-6.94"></path><path d="M9.9 4.24A10.58 10.58 0 0 1 12 4c7 0 11 8 11 8a21.77 21.77 0 0 1-3.2 4.9"></path>'
        : '<path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/><circle cx="12" cy="12" r="3"/>';
      toggle.setAttribute("aria-pressed", String(isPw));
    });

    function showToast(text){
      toast.textContent = text;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 2600);
    }

    async function updatePassword() {
      const newPassword = input.value.trim();

      const allGood =
        newPassword.length >= 8 &&
        /[a-z]/.test(newPassword) && /[A-Z]/.test(newPassword) &&
        /[0-9]/.test(newPassword) && /[^A-Za-z0-9]/.test(newPassword);

      if(!allGood){
        setHint("bad","Please meet all requirements before continuing");
        input.focus();
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Updating…";

      const { error } = await supabaseClient.auth.updateUser({ password: newPassword });

      submitBtn.disabled = false;
      submitBtn.textContent = "Update password";

      if (error) {
        showToast("❌ " + error.message);
      } else {
        showToast("✅ Password updated. Please log in again.");
        setTimeout(()=> { window.location.href = "login.html"; }, 900);
      }
    }

    // Initialize states on load
    updateRequirements("");
    window.updatePassword = updatePassword;
  </script>
</body>
</html>
